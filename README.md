# Telegram Travel Bot "Travel Luck"

Этот репозиторий содержит исходный код Telegram-бота для генерации тревел-постов.  
Бот умеет создавать текстовые заметки о путешествиях и изображения к ним с помощью нейросетей, сохранять результат в таблицу Google Sheets, а публикация постов в Telegram-канал выполняется автоматически по расписанию с помощью планировщика **Make**.

## Основные возможности  

- Генерация **заголовка** и **текста поста** (до 1000 символов).  
- Создание **изображения** по сгенерированному промпту.  
- Сохранение черновика поста в Google Sheets (id, статус, текст, промпт, file_id изображения и др.).  
- Работа с записями:  
  - `/newpost <тема>` — создать новый пост;  
  - `/list` — посмотреть список последних постов;  
  - `/list <id>` — просмотреть конкретный пост;  
  - `/edit <id>` — отредактировать заголовок, текст или промпт;  
  - `/delete <id>` — удалить запись.  
- Поддержка хранения ID картинки в Telegram (без лишнего префикса), что упрощает дальнейшую работу в Make.  
- Возможность плановой публикации в Telegram-канал через **Make**.  

## Особенности  

- Бот не публикует посты сам — он только готовит и сохраняет черновики.  
- Для планирования и публикации используется **Make**:  
  - По расписанию (например, 10:00 и 18:00 по Europe/Paris) сценарий забирает следующую запись со статусом `draft`.  
  - Отправляет текст и картинку в Telegram-канал.  
  - Обновляет статус поста в таблице на `posted` и сохраняет время публикации.  
- Код написан на **Python 3.10+**, с использованием `python-telegram-bot`, `google-api-python-client`, `httpx` и других библиотек.  

## Структура проекта  
telegram_travel_bot/
app/
bot.py # основной код Telegram-бота
generate.py # генерация текста и изображения
sheets.py # работа с Google Sheets
config.py # конфигурация и переменные окружения
init.py
.env.example # пример файла конфигурации
requirements.txt # зависимости
README.md # описание проекта


## Быстрый старт  

1. Создайте Google Cloud **Service Account** и скачайте JSON-ключ.  
   - Включите **Google Sheets API**.  
   - Поделитесь таблицей с e-mail сервисного аккаунта.  
2. Создайте таблицу Google Sheets и возьмите её **Spreadsheet ID** (из URL).  
3. Скопируйте `.env.example` в `.env` и заполните переменные.  
4. Установите зависимости:  
   ```bash
   python -m venv .venv && source .venv/bin/activate
   pip install -r requirements.txt
5. Запустите бота:
   ```bash
   python -m app.bot

В Telegram введите:
  /newpost Париж весной

Бот сгенерирует текст, создаст картинку и сохранит черновик в таблицу.

Make-сценарий

Триггер: расписание (например, 10:00 и 18:00).
Шаг 1: найти первую запись в Google Sheets со статусом draft.
Шаг 2: отправить в Telegram канал текст и картинку (по image_url, который совпадает с file_id Telegram).
Шаг 3: обновить запись — статус posted, заполнить posted_at, сохранить message_id.

